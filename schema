-- Users table
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  google_id VARCHAR(255) UNIQUE,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255) NOT NULL,
  role ENUM('admin', 'user') DEFAULT 'user',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Chemicals table
CREATE TABLE chemicals (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  batch_number VARCHAR(255) NOT NULL,
  brand VARCHAR(255),
  volume VARCHAR(100),
  initial_quantity INT NOT NULL,
  current_quantity INT NOT NULL,
  expiration_date DATE,
  date_of_arrival DATE,
  safety_class ENUM('safe', 'toxic', 'corrosive', 'reactive', 'flammable') DEFAULT 'safe',
  location VARCHAR(255),
  ghs_symbols JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Equipment table
CREATE TABLE equipment (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  model VARCHAR(255),
  serial_id VARCHAR(255) UNIQUE NOT NULL,
  status ENUM('Available', 'Broken', 'Under Maintenance') DEFAULT 'Available',
  location VARCHAR(255),
  purchase_date DATE,
  warranty_expiration DATE,
  condition ENUM('Good', 'Needs Repair', 'Broken') DEFAULT 'Good',
  last_maintenance DATE,
  next_maintenance DATE,
  assigned_user_id INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (assigned_user_id) REFERENCES users(id) ON DELETE SET NULL
);

-- Chemical usage log table
CREATE TABLE chemical_usage_logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  chemical_id INT NOT NULL,
  user_id INT NOT NULL,
  date DATE NOT NULL,
  location VARCHAR(255),
  quantity INT NOT NULL,
  notes TEXT,
  opened BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (chemical_id) REFERENCES chemicals(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Equipment maintenance log table
CREATE TABLE equipment_maintenance_logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  equipment_id INT NOT NULL,
  user_id INT NOT NULL,
  date DATE NOT NULL,
  action VARCHAR(255) NOT NULL,
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (equipment_id) REFERENCES equipment(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Audit logs table
CREATE TABLE audit_logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  type ENUM('chemical', 'equipment', 'user', 'system') NOT NULL,
  action VARCHAR(255) NOT NULL,
  item_name VARCHAR(255),
  user_id INT NOT NULL,
  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  details JSON,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Notifications table
CREATE TABLE notifications (
  id INT AUTO_INCREMENT PRIMARY KEY,
  type ENUM('low_stock', 'expiration', 'maintenance', 'system') NOT NULL,
  title VARCHAR(255) NOT NULL,
  message TEXT NOT NULL,
  item_type ENUM('chemical', 'equipment', 'system') NOT NULL,
  item_id INT,
  is_read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (item_id) REFERENCES chemicals(id) ON DELETE CASCADE
);